@startuml Spring Servlet Flow

participant "Tomcat" as Tomcat
participant "DispatcherServlet" as DS
participant "FilterChainProxy" as FCP
participant "OAuth2LoginAuthenticationFilter" as OAuth2Filter
participant "AnonymousAuthenticationFilter" as AnonFilter
participant "RequestMappingHandlerMapping" as HandlerMapping
participant "HomeController" as HC
participant "ContentNegotiatingViewResolver" as ViewResolver

== Servlet Initialization ==
Tomcat -> DS: Initialize
activate DS
DS -> DS: Initialize Components
note right of DS
  Detected Components:
  - StandardServletMultipartResolver
  - AcceptHeaderLocaleResolver
  - FixedThemeResolver
  - DefaultRequestToViewNameTranslator
  - SessionFlashMapManager
end note
DS --> Tomcat: Initialization Complete (2ms)
deactivate DS

== Request Processing (GET /) ==
Tomcat -> FCP: GET /
activate FCP
FCP -> OAuth2Filter: Check URL pattern
activate OAuth2Filter
note right of OAuth2Filter: Not matching '/login/oauth2/code/*'
OAuth2Filter --> FCP: Skip (no match)
deactivate OAuth2Filter

FCP -> AnonFilter: Process request
activate AnonFilter
AnonFilter -> AnonFilter: Set anonymous SecurityContext
AnonFilter --> FCP: Continue chain
deactivate AnonFilter

FCP -> DS: Forward to DispatcherServlet
deactivate FCP

activate DS
DS -> HandlerMapping: Find handler
activate HandlerMapping
HandlerMapping --> DS: Map to HomeController#home
deactivate HandlerMapping

DS -> HC: Execute home()
activate HC
HC -> HC: Check authentication
note right of HC: "No authenticated user"
HC --> DS: Return view
deactivate HC

DS -> ViewResolver: Resolve view
activate ViewResolver
note right of ViewResolver: Selected 'text/html'
ViewResolver --> DS: Return resolved view
deactivate ViewResolver

DS --> Tomcat: Complete (200 OK)
deactivate DS

== Favicon Request Processing ==
Tomcat -> FCP: GET /favicon.ico
activate FCP
FCP -> OAuth2Filter: Check URL pattern
activate OAuth2Filter
OAuth2Filter --> FCP: Skip (no match)
deactivate OAuth2Filter

FCP -> AnonFilter: Process request
activate AnonFilter
AnonFilter -> AnonFilter: Set anonymous SecurityContext
AnonFilter --> FCP: Continue chain
deactivate AnonFilter

FCP -> FCP: Redirect to /
FCP --> Tomcat: Redirect (302)
deactivate FCP

@enduml 